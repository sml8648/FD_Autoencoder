## 오토인코더를 활용한 이상금융거래 탐지 (ver.1)

* 현재 사내의 이상금융거래탐지 시스템(FDS)을 운영하고 있지만 룰베이스를 기반으로 운영을 하고 있으며 이에따라 알려지지 않은 이상금융거래(보이스피싱 등) 데이터에 대해서는 탐지율이 높지 않음.
* 머신러닝을 활용하여 지도학습을 실시하였으나 어느정도 성능은 확인되었으나 실제로 운용하기엔 부적절하다고 판단하였고 해당 문제의 원인이 불충분한 라벨링이라고 판단.
* 따라서 비지도 학습을 사용한 결과를 확인해보기로함

## 프로젝트 시작 동기 및 목표
* 당사는 카드회사는 아니지만 이상금융거래를 판단하는 AI 모델을 만드는 문제와 관련하여 '신용카드 사기 탐지' 문제와 유사하게 접근할 수 있다는 사실을 발견함. 따라서 Kaggle의 CCFD 데이터 세트와 솔루션들을 참고하여 최대한 유사하게 당사 데이터를 전처리하고 유사한 모델을 적용해보고자 함
  * https://www.kaggle.com/datasets/mlg-ulb/creditcardfraud?sort=votes
  
* 또한 'Reproducible Machine Learning for Credit Card Fraud detection - Practical handbook'의 내용을 참조하여 특성공학을 실시하였음
  * https://fraud-detection-handbook.github.io/fraud-detection-handbook/Chapter_3_GettingStarted/SimulatedDataset.html
  
* 따라서 신용카드 사기 탐지 문제와 유사하게 접근하기 위하여 각각의 출금 요청건에 대하여 정상요청거래인지 사기거래건인지 판단하고자함

## '신용카드 사기 탐지' 문제의 특징
* 불균형한 데이터셋
  * Kaggle credit card fraud detection dataset에서는 99%가 정상거래데이터 였으며 당사에서도 같은 현상이 확인됨.
  * 따라서 Accuracy 보다는 recall,precision,f1_score와 같은 metric이 모델의 성능 척도로 사용됨.
 
* 이진 분류 문제
  * 정상요청거래인지 사기거래건인지 판단하는 문제(개, 고양이 분류문제와 같음).
  
* 개, 고양이 분류문제와는 달리 정상거래와 사기거래가 거의 구분이 되지 않는 케이스들이 존재함.

## 데이터 구성 및 학습 방법
* 주요 feature들을 발굴하여 tabular 데이터 형식으로 만들었으며 2개월간의 데이터를 라벨링 없이 오토인코더로 학습
* 정상거래의 패턴에 대하여 더 많이 학습을 시키기 위하여 batch 사이즈를 매우 크게 설정(2048이상)
* MSE loss 함수를 사용하였고 모델 학습 후 어떠한 데이터를 통과시켰을때 loss값이 특정 임계점보다 높게나오는 출금요청건을 사기출금요청건이라고 판단.
* 이후 당사에 실제로 사기출금요청건이라고 신고가 들어온 요청건에 대해서 얼마나 탐지를 하는지로 성능을 평가

## 주요 feature

* 채널
  * 당사 서비스에 접근하는 채널로 [web/모바일(android/ios)/hts]로 이루어져 있으며 One-hot encoding으로 되어있음
  
* 출금요청건수(0/3/5/7/15)
  * 당일/3일간/7일간/15일간 출금을 요청한 건수
   
* 출금요청금액(0/3/5/7/15)
  * 당일/3일간/7일간/15일간 출금을 요청한 금액

* Otp 재발급요청건수(0/3/5/7/15)
  * 당일/3일간/7일간/15일간 Otp 재발급을 요청한 건수

* 증권담보대출요청건수(0/3/5/7/15)
  * 당일/3일간/7일간/15일간 증권담보대출을 요청한 건수

* 증권담보대출요청금액(0/3/5/7/15)
  * 당일/3일간/7일간/15일간 출금을 요청한 금액

* 출금요청금액(0/3/5/7/15)
  * 당일/3일간/7일간/15일간 출금을 요청한 금액

* 당사계좌입금건수(0/3/5/7/15)
  * 당일/3일간/7일간/15일간 당사계좌로 입금된 건수

* Atm출금건수(0/3/5/7/15)
  * 당일/3일간/7일간/15일간 Atm으로 출금을 요청한 건수

* 주간/야간 여부
* 요일(평일/휴일 여부)
* 고객의 연령
* 고객의 등록 날짜
* 비대면 계좌 여부
  
## 프로젝트 소스 코드 

* 해당 코드는 pytorch ignite를 이용하여 작성
* Data 폴더는 내부데이터가 포함이라 제외
```
FDS_Autoencoder/
    Data/ => (confidential)
       train
         train_data.pkl
       test
         test_data.pkl
         
    __init__.py
    model/
        __init__.py
        Autoencoder.py
    CheckPoint
        Date_Autoencoder.pt
    train.py
    trainer.py
    classify.py
    data_loader.py
```

## 모델 적용 결과
* 이상치가 매우 많아 모델을 통과시킨 결과인 mse에 log를 적용한 값에 임계점을 적용하여 정상출금요청인지 사기출금요청인지 판단
* 임계점을 0으로 설정하였을때는 보통 평일의 출금요청건 중 3% ~ 5%에 해당하는 출금요청건을 사기라고 판단.

![다운로드 (5)](https://user-images.githubusercontent.com/18714388/181781088-54d5e171-b40e-45db-8e9c-5e78a82511d7.png)

## 결론

## 더 생각해볼점
